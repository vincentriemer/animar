!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.Animar=n()}(this,function(){"use strict";function t(t,n){var r=n.currentIteration,e=n.totalIterations,i=n.easingFunction,a=n.startValue,u=n.changeInValue;return r<0?r=0:r>e&&(r=e),t+i(r,a,u,e)}function n(n){return n.reduce(t,0)}function r(t){return function(n){var r=n.currentIteration,e=n.totalIterations,i=n.wait,a=n.delay,u=n.looping;return r<e+i?C({},n,{currentIteration:r+t}):u?C({},n,{currentIteration:0-a}):null}}function e(t){return function(n){return C({},n,{looping:!0,wait:t.totalDuration-n.delay-n.totalIterations})}}function i(t,n,r,e,i,a){return{currentIteration:t,startValue:n,changeInValue:r,totalIterations:e,easingFunction:i,delay:a,looping:E.looping,wait:E.wait}}function a(t){return function(n){return{model:n.model,animations:n.animations.concat([t])}}}function u(t){return function(n){return{model:t.model,animations:n.animations.concat(t.animations)}}}function o(t){return function(n){return C({},n,{animations:n.animations.map(r(t)).filter(function(t){return t})})}}function c(t){return function(n){return C({},n,{animations:n.animations.map(e(t))})}}function l(t){return String(t.model+n(t.animations))}function s(t){return{model:t,animations:[]}}function f(t){var n=[],r=!0,e=!1,i=void 0;try{for(var a,u=Object.keys(t)[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var o=a.value;n.push([o,t[o]])}}catch(t){e=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(e)throw i}}return n}function d(t){return function(n,r){return f(t).reduce(function(t,r){var e=D(r,2),i=e[0],a=e[1];return n(t,a,i)},r)}}function h(t){return function(n){return d(t)(function(t,r,e){return t[e]=n(r),t},{})}}function y(t,n){return function(r){return{attributes:C({},r.attributes,P({},t,n))}}}function v(t){return function(n){return{attributes:d(t.attributes)(function(t,n,r){var e=t[r];return null!=e?t[r]=u(n)(e):t[r]=n,t},n.attributes)}}}function g(t){return function(n){return{attributes:h(n.attributes)(o(t))}}}function p(t){return function(n){return{attributes:h(n.attributes)(c(t))}}}function m(){return{attributes:{}}}function k(t){return function(n){var r=C({},n);return r.currentIteration<=r.wait&&(r.currentIteration=r.currentIteration+t),r.currentIteration>0&&!r.called?(r.hook(),r.called=!0):r.currentIteration===n.currentIteration&&r.looping&&(r.currentIteration=0-r.delay,r.called=!1),r}}function F(t){return function(n){return C({},n,{looping:!0,wait:t.totalDuration-n.delay})}}function b(t,n,r){return C({},O,{hook:t,currentIteration:n,delay:r})}function w(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=t.defaults||{},r=null==n.delay?A:n.delay,e=null==n.easingFunction?j:n.easingFunction,i=null==n.duration?R:n.duration;return{defaultDelay:r,defaultEase:e,defaultDuration:i}}var M=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},I=function(){function t(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(n,r,e){return r&&t(n.prototype,r),e&&t(n,e),n}}(),P=function(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t},C=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t},D=function(){function t(t,n){var r=[],e=!0,i=!1,a=void 0;try{for(var u,o=t[Symbol.iterator]();!(e=(u=o.next()).done)&&(r.push(u.value),!n||r.length!==n);e=!0);}catch(t){i=!0,a=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw a}}return r}return function(n,r){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),E={looping:!1,wait:0},O={looping:!1,called:!1,wait:0},T=function(){function t(){M(this,t),this.renderRegistry={},this.attributePluginMapping={},this.timingPlugin=null}return I(t,[{key:"addRenderPlugin",value:function(t){var n=this,r=t.name,e=t.attributes,i=t.render;this.renderRegistry[r]=i,e.forEach(function(t){null==n.attributePluginMapping[t]&&(n.attributePluginMapping[t]=[]),n.attributePluginMapping[t].push(r)})}},{key:"callRenderPlugins",value:function(t,n){var r=this,e=d(n.attributes)(function(t,n,e){var i=r.attributePluginMapping[e];return null==i?t:(i.forEach(function(r){null==t[r]&&(t[r]={}),t[r][e]=l(n)}),t)},{});f(e).forEach(function(n){var e=D(n,2),i=e[0],a=e[1];r.renderRegistry[i](t,a)})}},{key:"addTimingPlugin",value:function(t){null!==this.tickMethod&&console.warn("WARNING: A timing plugin was already installed, overriding..."),this.timingPlugin=t}},{key:"addPreset",value:function(t){var n=t.renderPlugins,r=void 0===n?[]:n,e=t.timingPlugin;r.forEach(this.addRenderPlugin.bind(this)),null!=e&&this.addTimingPlugin(e)}}]),t}(),j=function(t,n,r,e){return r*t/e+n},A=0,R=60,x=function(){return{delay:0,currentDuration:0,totalDuration:0}},S={delay:null,easingFunction:null,duration:null},V=16.67,q=function(){function t(n){M(this,t);var r=w(n),e=r.defaultDelay,i=r.defaultEase,a=r.defaultDuration;this.ticking=!1,this.elementMap=new Map,this.defaults={delay:e,easingFunction:i,duration:a},this.hooks=[],this.firstFrame=!0,this.previousTime=0,this.registry=new T}return I(t,[{key:"addAnimationToChain",value:function(t,n,r,e,u,o,c){t-=n;var l=i(0-(r.delay-e.delay),t,0-t,r.duration,r.easingFunction,0),f=a(l)(s(n)),d=y(u,f)(m()),h=new Map;return h.set(o,d),this.mergeElementMaps(h)(c)}},{key:"mergeElementMaps",value:function(t){return function(n){var r=new Map(n.entries());return t.forEach(function(t,n){r.has(n)?r.set(n,v(t)(r.get(n))):r.set(n,t)}),r}}},{key:"resolveAnimationOptions",value:function(t){return{delay:null==t.delay?this.defaults.delay:t.delay,easingFunction:null==t.easingFunction?this.defaults.easingFunction:t.easingFunction,duration:null==t.duration?this.defaults.duration:t.duration}}},{key:"add",value:function(t,n){var r=arguments.length<=2||void 0===arguments[2]?S:arguments[2];return this._add(t,n,r,x(),new Map,[])}},{key:"_add",value:function(t,n,r,e,i,a){var u=this,o=this.resolveAnimationOptions(r);return Object.keys(n).forEach(function(r){var a=n[r],c=a[0],l=a[1];i=u.addAnimationToChain(c,l,o,e,r,t,i)}),e.currentDuration=Math.max(e.currentDuration,o.delay+o.duration),this.fullChainObjectFactory(e,i,a)}},{key:"addHook",value:function(t,n,r,e){var i=b(t,0-n.delay,n.delay);return this.fullChainObjectFactory(n,r,e.concat([i]))}},{key:"fullChainObjectFactory",value:function(t,n,r){return{start:this.startChainFunctionFactory(n,r),loop:this.loopChainFunctionFactory(t,n,r),add:this.addChainFunctionFactory(t,n,r),then:this.thenChainFunctionFactory(t,n,r),hook:this.hookChainFunctionFactory(t,n,r)}}},{key:"thenChainFunctionFactory",value:function(t,n,r){var e=this;return function(){var i=arguments.length<=0||void 0===arguments[0]?0:arguments[0],a=t.totalDuration+t.currentDuration+i,u={totalDuration:a,delay:a,currentDuration:0};return{add:e.addChainFunctionFactory(u,n,r),hook:e.hookChainFunctionFactory(u,n,r)}}}},{key:"addChainFunctionFactory",value:function(t,n,r){var e=this;return function(i,a){var u=arguments.length<=2||void 0===arguments[2]?S:arguments[2];return e._add(i,a,u,t,n,r)}}},{key:"loopChainFunctionFactory",value:function(t,n,r){var e=this;return function(){var i=Object.assign(t,{totalDuration:t.totalDuration+t.currentDuration}),a=Array.from(n.entries()).reduce(function(t,n){var r=D(n,2),e=r[0],a=r[1];return t.set(e,p(i)(a)),t},new Map),u=r.map(F(i));return{start:e.startChainFunctionFactory(a,u)}}}},{key:"startChainFunctionFactory",value:function(t,n){var r=this;return function(){r.elementMap=r.mergeElementMaps(t)(r.elementMap),r.hooks=r.hooks.concat(n),r.requestTick()}}},{key:"hookChainFunctionFactory",value:function(t,n,r){var e=this;return function(i){return e.addHook(i,t,n,r)}}},{key:"requestTick",value:function(){if(!this.ticking){var t=this.registry.timingPlugin;if(null==t)throw new Error("Attempted to animate without providing a Timing Plugin");t(this.update.bind(this)),this.ticking=!0}}},{key:"update",value:function(t){var n=t-this.previousTime;this.firstFrame&&(n=V,this.firstFrame=!1);var r=n/V;this.previousTime=t,this.ticking=!1;var e=this.step(r,this.elementMap,this.hooks),i=D(e,2),a=i[0],u=i[1];this.hooks=u,this.elementMap=a,this.render(),this.requestTick()}},{key:"render",value:function(){var t=this;this.elementMap.forEach(function(n,r){t.registry.callRenderPlugins(r,n)})}},{key:"step",value:function(t,n,r){var e=r.map(k(t)).filter(function(t,n){return t!==r[n]}),i=Array.from(n.entries()).reduce(function(n,r){var e=D(r,2),i=e[0],a=e[1];return n.set(i,g(t)(a)),n},new Map);return[i,e]}}]),t}();return q});