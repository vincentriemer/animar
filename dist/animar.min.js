!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.Animar=n()}(this,function(){"use strict";function t(t,n){var e=n.currentIteration,r=n.totalIterations,i=n.easingFunction,a=n.startValue,u=n.changeInValue;return e<0?e=0:e>r&&(e=r),t+i(e,a,u,r)}function n(n){return n.reduce(t,0)}function e(t){return function(n){var e=n.currentIteration,r=n.totalIterations,i=n.wait,a=n.delay,u=n.looping;return e<r+i?C.extends({},n,{currentIteration:e+t}):u?C.extends({},n,{currentIteration:0-a}):null}}function r(t){return function(n){return C.extends({},n,{looping:!0,wait:t.totalDuration-n.delay-n.totalIterations})}}function i(t,n,e,r,i,a){return{currentIteration:t,startValue:n,changeInValue:e,totalIterations:r,easingFunction:i,delay:a,looping:P.looping,wait:P.wait}}function a(t){return function(n){return{model:n.model,animations:n.animations.concat([t])}}}function u(t){return function(n){return{model:t.model,animations:n.animations.concat(t.animations)}}}function o(t){return function(n){return C.extends({},n,{animations:n.animations.map(e(t)).filter(function(t){return t})})}}function c(t){return function(n){return C.extends({},n,{animations:n.animations.map(r(t))})}}function l(t){return String(t.model+n(t.animations))}function s(t){return{model:t,animations:[]}}function f(t){var n=[],e=!0,r=!1,i=void 0;try{for(var a,u=Object.keys(t)[Symbol.iterator]();!(e=(a=u.next()).done);e=!0){var o=a.value;n.push([o,t[o]])}}catch(t){r=!0,i=t}finally{try{!e&&u.return&&u.return()}finally{if(r)throw i}}return n}function d(t){return function(n,e){return f(t).reduce(function(t,e){var r=C.slicedToArray(e,2),i=r[0],a=r[1];return n(t,a,i)},e)}}function h(t){return function(n){return d(t)(function(t,e,r){return t[r]=n(e),t},{})}}function y(t,n){return function(e){return{attributes:C.extends({},e.attributes,C.defineProperty({},t,n))}}}function v(t){return function(n){return{attributes:d(t.attributes)(function(t,n,e){var r=t[e];return null!=r?t[e]=u(n)(r):t[e]=n,t},n.attributes)}}}function g(t){return function(n){return{attributes:h(n.attributes)(o(t))}}}function p(t){return function(n){return{attributes:h(n.attributes)(c(t))}}}function m(){return{attributes:{}}}function k(t){return function(n){var e=C.extends({},n);return e.currentIteration<=e.wait&&(e.currentIteration=e.currentIteration+t),e.currentIteration>0&&!e.called?(e.hook(),e.called=!0):e.currentIteration===n.currentIteration&&e.looping&&(e.currentIteration=0-e.delay,e.called=!1),e}}function F(t){return function(n){return C.extends({},n,{looping:!0,wait:t.totalDuration-n.delay})}}function b(t,n,e){return C.extends({},M,{hook:t,currentIteration:n,delay:e})}function w(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=t.defaults||{},e=null==n.delay?A:n.delay,r=null==n.easingFunction?T:n.easingFunction,i=null==n.duration?D:n.duration;return{defaultDelay:e,defaultEase:r,defaultDuration:i}}var C={};C.classCallCheck=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},C.createClass=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),C.defineProperty=function(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t},C.extends=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},C.slicedToArray=function(){function t(t,n){var e=[],r=!0,i=!1,a=void 0;try{for(var u,o=t[Symbol.iterator]();!(r=(u=o.next()).done)&&(e.push(u.value),!n||e.length!==n);r=!0);}catch(t){i=!0,a=t}finally{try{!r&&o.return&&o.return()}finally{if(i)throw a}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var P={looping:!1,wait:0},M={looping:!1,called:!1,wait:0},I=function(){function t(){C.classCallCheck(this,t),this.renderRegistry={},this.attributePluginMapping={},this.timingPlugin=null}return C.createClass(t,[{key:"addRenderPlugin",value:function(t){var n=this,e=t.name,r=t.attributes,i=t.render;this.renderRegistry[e]=i,r.forEach(function(t){null==n.attributePluginMapping[t]&&(n.attributePluginMapping[t]=[]),n.attributePluginMapping[t].push(e)})}},{key:"callRenderPlugins",value:function(t,n){var e=this,r=d(n.attributes)(function(t,n,r){var i=e.attributePluginMapping[r];return null==i?t:(i.forEach(function(e){null==t[e]&&(t[e]={}),t[e][r]=l(n)}),t)},{});f(r).forEach(function(n){var r=C.slicedToArray(n,2),i=r[0],a=r[1];e.renderRegistry[i](t,a)})}},{key:"addTimingPlugin",value:function(t){null!==this.tickMethod&&console.warn("WARNING: A timing plugin was already installed, overriding..."),this.timingPlugin=t}},{key:"addPreset",value:function(t){var n=t.renderPlugins,e=void 0===n?[]:n,r=t.timingPlugin;e.forEach(this.addRenderPlugin.bind(this)),null!=r&&this.addTimingPlugin(r)}}]),t}(),T=function(t,n,e,r){return e*t/r+n},A=0,D=60,x=function(){return{delay:0,currentDuration:0,totalDuration:0}},E={delay:null,easingFunction:null,duration:null},O=16.67,j=function(){function t(n){C.classCallCheck(this,t);var e=w(n),r=e.defaultDelay,i=e.defaultEase,a=e.defaultDuration;this.ticking=!1,this.elementMap=new Map,this.defaults={delay:r,easingFunction:i,duration:a},this.hooks=[],this.firstFrame=!0,this.previousTime=0,this.registry=new I}return C.createClass(t,[{key:"addAnimationToChain",value:function(t,n,e,r,u,o,c){t-=n;var l=i(0-(e.delay-r.delay),t,0-t,e.duration,e.easingFunction,0),f=a(l)(s(n)),d=y(u,f)(m()),h=new Map;return h.set(o,d),this.mergeElementMaps(h)(c)}},{key:"mergeElementMaps",value:function(t){return function(n){var e=new Map(n.entries());return t.forEach(function(t,n){e.has(n)?e.set(n,v(t)(e.get(n))):e.set(n,t)}),e}}},{key:"resolveAnimationOptions",value:function(t){return{delay:null==t.delay?this.defaults.delay:t.delay,easingFunction:null==t.easingFunction?this.defaults.easingFunction:t.easingFunction,duration:null==t.duration?this.defaults.duration:t.duration}}},{key:"add",value:function(t,n){var e=arguments.length<=2||void 0===arguments[2]?E:arguments[2];return this._add(t,n,e,x(),new Map,[])}},{key:"_add",value:function(t,n,e,r,i,a){var u=this,o=this.resolveAnimationOptions(e);return Object.keys(n).forEach(function(e){var a=n[e],c=a[0],l=a[1];i=u.addAnimationToChain(c,l,o,r,e,t,i)}),r.currentDuration=Math.max(r.currentDuration,o.delay+o.duration),this.fullChainObjectFactory(r,i,a)}},{key:"addHook",value:function(t,n,e,r){var i=b(t,0-n.delay,n.delay);return this.fullChainObjectFactory(n,e,r.concat([i]))}},{key:"fullChainObjectFactory",value:function(t,n,e){return{start:this.startChainFunctionFactory(n,e),loop:this.loopChainFunctionFactory(t,n,e),add:this.addChainFunctionFactory(t,n,e),then:this.thenChainFunctionFactory(t,n,e),hook:this.hookChainFunctionFactory(t,n,e)}}},{key:"thenChainFunctionFactory",value:function(t,n,e){var r=this;return function(){var i=arguments.length<=0||void 0===arguments[0]?0:arguments[0],a=t.totalDuration+t.currentDuration+i,u={totalDuration:a,delay:a,currentDuration:0};return{add:r.addChainFunctionFactory(u,n,e),hook:r.hookChainFunctionFactory(u,n,e)}}}},{key:"addChainFunctionFactory",value:function(t,n,e){var r=this;return function(i,a){var u=arguments.length<=2||void 0===arguments[2]?E:arguments[2];return r._add(i,a,u,t,n,e)}}},{key:"loopChainFunctionFactory",value:function(t,n,e){var r=this;return function(){var i=Object.assign(t,{totalDuration:t.totalDuration+t.currentDuration}),a=Array.from(n.entries()).reduce(function(t,n){var e=C.slicedToArray(n,2),r=e[0],a=e[1];return t.set(r,p(i)(a)),t},new Map),u=e.map(F(i));return{start:r.startChainFunctionFactory(a,u)}}}},{key:"startChainFunctionFactory",value:function(t,n){var e=this;return function(){e.elementMap=e.mergeElementMaps(t)(e.elementMap),e.hooks=e.hooks.concat(n),e.requestTick()}}},{key:"hookChainFunctionFactory",value:function(t,n,e){var r=this;return function(i){return r.addHook(i,t,n,e)}}},{key:"requestTick",value:function(){if(!this.ticking){var t=this.registry.timingPlugin;if(null==t)throw new Error("Attempted to animate without providing a Timing Plugin");t(this.update.bind(this)),this.ticking=!0}}},{key:"update",value:function(t){var n=t-this.previousTime;this.firstFrame&&(n=O,this.firstFrame=!1);var e=n/O;this.previousTime=t,this.ticking=!1;var r=this.step(e,this.elementMap,this.hooks),i=C.slicedToArray(r,2),a=i[0],u=i[1];this.hooks=u,this.elementMap=a,this.render(),this.requestTick()}},{key:"render",value:function(){var t=this;this.elementMap.forEach(function(n,e){t.registry.callRenderPlugins(e,n)})}},{key:"step",value:function(t,n,e){var r=e.map(k(t)).filter(function(t,n){return t!==e[n]}),i=Array.from(n.entries()).reduce(function(n,e){var r=C.slicedToArray(e,2),i=r[0],a=r[1];return n.set(i,g(t)(a)),n},new Map);return[i,r]}}]),t}();return j});