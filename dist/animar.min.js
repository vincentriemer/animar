!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.Animar=t.Animar||{})}(this,function(t){"use strict";function n(t,n){var r=n.currentIteration,i=n.totalIterations,e=n.easingFunction,a=n.startValue,u=n.changeInValue;return r<0?r=0:r>i&&(r=i),t+e(r,a,u,i)}function r(t){return t.reduce(n,0)}function i(t){return function(n){var r=n.currentIteration,i=n.totalIterations,e=n.wait,a=n.delay,u=n.looping;return r<i+e?Object.assign({},n,{currentIteration:r+t}):u?Object.assign({},n,{currentIteration:0-a}):null}}function e(t){return function(n){return Object.assign({},n,{looping:!0,wait:t.totalDuration-n.delay-n.totalIterations})}}function a(t,n,r,i,e,a){return{currentIteration:t,startValue:n,changeInValue:r,totalIterations:i,easingFunction:e,delay:a,looping:A.looping,wait:A.wait}}function u(t){return function(n){return Object.assign({},n,{animations:n.animations.concat([t])})}}function o(t){return function(n){return Object.assign({},n,{model:t.model,animations:n.animations.concat(t.animations)})}}function c(t){return function(n){return Object.assign({},n,{animations:n.animations.map(i(t)).filter(function(t){return t})})}}function s(t){return function(n){return Object.assign({},n,{animations:n.animations.map(e(t))})}}function l(t){return String(t.model+r(t.animations))}function f(t){return{model:t,animations:[]}}function d(t){var n=[],r=!0,i=!1,e=void 0;try{for(var a,u=Object.keys(t)[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var o=a.value;n.push([o,t[o]])}}catch(t){i=!0,e=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw e}}return n}function h(t){return function(n,r){return d(t).reduce(function(t,r){var i=w(r,2),e=i[0],a=i[1];return n(t,a,e)},r)}}function g(t){return function(n){return h(t)(function(t,r,i){return t[i]=n(r),t},{})}}function y(t,n){return function(r){return Object.assign({},r,{attributes:Object.assign({},r.attributes,D({},t,n))})}}function p(t){return function(n){return Object.assign({},n,{attributes:h(t.attributes)(function(t,n,r){var i=t[r];return null!=i?t[r]=o(n)(i):t[r]=n,t},n.attributes)})}}function m(t){return function(n){return Object.assign({},n,{attributes:g(n.attributes)(c(t))})}}function v(t){return function(n){return Object.assign({},n,{attributes:g(n.attributes)(s(t))})}}function b(){return{attributes:{}}}function F(t){return function(n){var r=Object.assign({},n);return r.currentIteration<=r.wait&&(r.currentIteration=r.currentIteration+t),r.currentIteration>0&&!r.called?(r.hook(),r.called=!0):r.currentIteration===n.currentIteration&&r.looping&&(r.currentIteration=0-r.delay,r.called=!1),r}}function O(t){return function(n){return Object.assign({},n,{looping:!0,wait:t.totalDuration-n.delay})}}function j(t,n,r){return Object.assign({},E,{hook:t,currentIteration:n,delay:r})}function k(){return Object.assign(Object.create(T),{renderRegistry:{},attributePluginMapping:{},tickMethod:null})}function I(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=t.defaults||{},r=null==n.delay?N:n.delay,i=null==n.easingFunction?P:n.easingFunction,e=null==n.duration?R:n.duration;return{defaultDelay:r,defaultEase:i,defaultDuration:e}}function M(t){var n=I(t),r=n.defaultDelay,i=n.defaultEase,e=n.defaultDuration;return Object.assign(Object.create(U),{ticking:!1,elementMap:new Map,defaults:{delay:r,easingFunction:i,duration:e},hooks:[],firstFrame:!0,previousTime:0,registry:k()})}var A={looping:!1,wait:0},D=function(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t},w=function(){function t(t,n){var r=[],i=!0,e=!1,a=void 0;try{for(var u,o=t[Symbol.iterator]();!(i=(u=o.next()).done)&&(r.push(u.value),!n||r.length!==n);i=!0);}catch(t){e=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(e)throw a}}return r}return function(n,r){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),C=function(t){if(Array.isArray(t)){for(var n=0,r=Array(t.length);n<t.length;n++)r[n]=t[n];return r}return Array.from(t)},E={looping:!1,wait:0,called:!1},T={addRenderPlugin:function(t){var n=this,r=t.name,i=t.attributes,e=t.render;this.renderRegistry[r]=e,i.forEach(function(t){null==n.attributePluginMapping[t]&&(n.attributePluginMapping[t]=[]),n.attributePluginMapping[t].push(r)})},callRenderPlugins:function(t,n){var r=this,i=h(n.attributes)(function(t,n,i){var e=r.attributePluginMapping[i];return null==e?t:(e.forEach(function(r){null==t[r]&&(t[r]={}),t[r][i]=l(n)}),t)},{});d(i).forEach(function(n){var i=w(n,2),e=i[0],a=i[1];r.renderRegistry[e](t,a)})},addTimingPlugin:function(t){null!==this.tickMethod&&console.warn("WARNING: A timing plugin was already installed, overriding..."),this.tickMethod=t},addPreset:function(t){var n=t.renderPlugins,r=void 0===n?[]:n,i=t.timingPlugin;r.forEach(this.addRenderPlugin.bind(this)),null!=i&&this.addTimingPlugin(i)}},P=function(t,n,r,i){return r*t/i+n},N=0,R=60,_=function(){return{delay:0,currentDuration:0,totalDuration:0}},x={delay:null,easingFunction:null,duration:null,loop:null},S=16.67,U={addAnimationToChain:function(t,n,r,i,e,o,c){t-=n;var s=a(0-(r.delay-i.delay),t,0-t,r.duration,r.easingFunction,0),l=u(s)(f(n)),d=y(e,l)(b()),h=new Map;return h.set(o,d),this.mergeElementMaps(h)(c)},mergeElementMaps:function(t){return function(n){var r=new Map(n.entries());return t.forEach(function(t,n){r.has(n)?r.set(n,p(t)(r.get(n))):r.set(n,t)}),r}},resolveAnimationOptions:function(t){return{delay:null==t.delay?this.defaults.delay:t.delay,easingFunction:null==t.easingFunction?this.defaults.easingFunction:t.easingFunction,duration:null==t.duration?this.defaults.duration:t.duration}},add:function(t,n){var r=arguments.length<=2||void 0===arguments[2]?x:arguments[2];return this._add(t,n,r,_(),new Map,[])},_add:function(t,n,r,i,e,a){var u=this,o=this.resolveAnimationOptions(r);return Object.keys(n).forEach(function(r){var a=n[r],c=a[0],s=a[1];e=u.addAnimationToChain(c,s,o,i,r,t,e)}),i.currentDuration=Math.max(i.currentDuration,o.delay+o.duration),this.fullChainObjectFactory(i,e,a)},addHook:function(t,n,r,i){var e=j(t,0-n.delay,n.delay);return this.fullChainObjectFactory(n,r,i.concat([e]))},fullChainObjectFactory:function(t,n,r){return{start:this.startChainFunctionFactory(n,r),loop:this.loopChainFunctionFactory(t,n,r),add:this.addChainFunctionFactory(t,n,r),then:this.thenChainFunctionFactory(t,n,r),hook:this.hookChainFunctionFactory(t,n,r)}},thenChainFunctionFactory:function(t,n,r){var i=this;return function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],a=t.totalDuration+t.currentDuration+e,u={totalDuration:a,currentDuration:0,delay:a};return{add:i.addChainFunctionFactory(u,n,r),hook:i.hookChainFunctionFactory(u,n,r)}}},addChainFunctionFactory:function(t,n,r){var i=this;return function(e,a){var u=arguments.length<=2||void 0===arguments[2]?x:arguments[2];return i._add(e,a,u,t,n,r)}},loopChainFunctionFactory:function(t,n,r){var i=this;return function(){var e=Object.assign(t,{totalDuration:t.totalDuration+t.currentDuration}),a=[].concat(C(n.entries())).reduce(function(t,n){var r=w(n,2),i=r[0],a=r[1];return t.set(i,v(e)(a)),t},new Map),u=r.map(O(e));return{start:i.startChainFunctionFactory(a,u)}}},startChainFunctionFactory:function(t,n){var r=this;return function(){r.elementMap=r.mergeElementMaps(t)(r.elementMap),r.hooks=r.hooks.concat(n),r.requestTick()}},hookChainFunctionFactory:function(t,n,r){var i=this;return function(e){return i.addHook(e,t,n,r)}},requestTick:function(){this.ticking||(this.registry.tickMethod(this.update.bind(this)),this.ticking=!0)},update:function(t){var n=t-this.previousTime;this.firstFrame&&(n=S,this.firstFrame=!1);var r=n/S;this.previousTime=t,this.ticking=!1;var i=this.step(r,this.elementMap,this.hooks),e=w(i,2),a=e[0],u=e[1];this.hooks=u,this.elementMap=a,this.render(),this.requestTick()},render:function(){var t=this;this.elementMap.forEach(function(n,r){t.registry.callRenderPlugins(r,n)})},step:function(t,n,r){var i=r.map(F(t)).filter(function(t,n){return t!==r.get(n)}),e=[].concat(C(n.entries())).reduce(function(n,r){var i=w(r,2),e=i[0],a=i[1];return n.set(e,m(t)(a)),n},new Map);return[e,i]}};t.DEFAULT_EASING_FUNCTION=P,t.DEFAULT_DELAY=N,t.DEFAULT_DURATION=R,t.initialChainOptions=_,t.EMPTY_ANIMATION_OPTIONS=x,t.default=M});